import{P as O}from"./phaser-0RJB29YE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();var c=(s=>(s.IDLE="IDLE",s.WANDERING="WANDERING",s.FORAGING="FORAGING",s.RETURNING="RETURNING",s))(c||{});class S{constructor(t,e,r,i,n=100){this.id=t,this.x=e,this.y=r,this.vx=0,this.vy=0,this.targetVx=0,this.targetVy=0,this.state=c.IDLE,this.colonyId=i,this.timeSinceDirectionChange=0,this.timeInCurrentState=0,this.perceptionRange=n}}const R={CANVAS_WIDTH:1024,CANVAS_HEIGHT:768,BACKGROUND_COLOR:"#2d4a2e"},G={INITIAL_ANT_COUNT:20},_={SPEED:50,CHANGE_DIRECTION_INTERVAL:2,TURN_SPEED:.3},E={IDLE_TO_WANDERING_CHANCE:.5,WANDERING_MIN_DURATION:3,WANDERING_TO_FORAGING_CHANCE:.1,WANDERING_TO_RETURNING_CHANCE:.05,FORAGING_MIN_DURATION:5,FORAGING_TO_RETURNING_CHANCE:.1},p={HOME_ARRIVAL_DISTANCE:15},f={OBSTACLE_DETECTION_RANGE:80,PERCEPTION_RANGE:100},l={BODY_RADIUS:3,HEAD_RADIUS:2,HEAD_COLOR:6636321,STATE_COLORS:{IDLE:8421504,WANDERING:9127187,FORAGING:4881486,RETURNING:4286881},DEFAULT_BODY_COLOR:9127187},h={NEST_RADIUS:20,NEST_COLOR:7356948,NEST_BORDER_COLOR:9127187,NEST_BORDER_WIDTH:2,NEST_OPACITY:.6,ENTRANCE_RADIUS_MULTIPLIER:.4,ENTRANCE_COLOR:0,ENTRANCE_OPACITY:.3},o={TITLE:{X:16,Y:16,FONT_SIZE:"32px",COLOR:"#ffffff",TEXT:"Ants!"},INSTRUCTIONS:{X:16,Y:56,FONT_SIZE:"16px",COLOR:"#cccccc",TEXT:"Watch the ants wander and return home..."},LEGEND:{X:16,Y:84,FONT_SIZE:"12px",COLOR:"#aaaaaa",TEXT:"Colors: Gray=Idle, Brown=Wandering, Green=Foraging, Blue=Returning"},DEBUG:{X:16,Y_OFFSET_FROM_BOTTOM:40,FONT_SIZE:"14px",COLOR:"#ffffff",BACKGROUND_COLOR:"#00000088",PADDING:{x:8,y:4}},UI_DEPTH:100};class x{constructor(t,e,r){this.id=t,this.x=e,this.y=r,this.ants=[],this.resourceCount=0}spawnAnt(t){const e=new S(t,this.x,this.y,this.id,f.PERCEPTION_RANGE);return this.ants.push(e),e}getAnts(){return[...this.ants]}getAntCount(){return this.ants.length}}class L{constructor(t,e){this.width=t,this.height=e,this.colonies=[],this.obstacles=[],this.nextAntId=0,this.cachedAnts=[],this.antsCacheDirty=!0}createColony(t,e){const r=this.colonies.length,i=new x(r,t,e);return this.colonies.push(i),i}spawnAnt(t){const e=t.spawnAnt(this.nextAntId++);return this.antsCacheDirty=!0,e}getAllAnts(){if(this.antsCacheDirty){this.cachedAnts=[];for(const t of this.colonies)this.cachedAnts.push(...t.getAnts());this.antsCacheDirty=!1}return this.cachedAnts}getColonies(){return[...this.colonies]}getColony(t){return this.colonies[t]}addObstacle(t){this.obstacles.push(t)}getObstacles(){return this.obstacles}getObstaclesNear(t,e,r){const i=[];for(const n of this.obstacles){const a=n.x-t,d=n.y-e;Math.sqrt(a*a+d*d)-n.radius<=r&&i.push(n)}return i}}function D(s,t){const e=Math.random()*Math.PI*2;s.targetVx=Math.cos(e)*t.speed,s.targetVy=Math.sin(e)*t.speed}function U(s,t,e,r){const i=t-s.x,n=e-s.y,a=Math.sqrt(i*i+n*n);a>0&&(s.targetVx=i/a*r.speed,s.targetVy=n/a*r.speed)}function m(s,t,e,r=10){const i=t-s.x,n=e-s.y;return i*i+n*n<r*r}function w(s,t,e){const r=Math.min(1,t.turnSpeed*e*10);s.vx+=(s.targetVx-s.vx)*r,s.vy+=(s.targetVy-s.vy)*r}function b(s,t){s.x+=s.vx*t,s.y+=s.vy*t}function F(s,t){(s.x<0||s.x>t.width)&&(s.vx*=-1,s.x=Math.max(0,Math.min(t.width,s.x))),(s.y<0||s.y>t.height)&&(s.vy*=-1,s.y=Math.max(0,Math.min(t.height,s.y)))}function v(s,t,e){const r=t.getObstaclesNear(s.x,s.y,e);if(r.length===0)return null;let i=null,n=1/0;const a=Math.sqrt(s.vx*s.vx+s.vy*s.vy);if(a===0)return null;const d=s.vx/a,T=s.vy/a;for(const N of r){const C=N.x-s.x,A=N.y-s.y,u=Math.sqrt(C*C+A*A);(C*d+A*T)/u>.5&&u<n&&(n=u,i=N)}return i}function M(s,t,e){const r=t.x-s.x,i=t.y-s.y,n=Math.sqrt(r*r+i*i);if(n===0)return;const a=-i,d=r,N=(s.vx*a+s.vy*d)/n>=0?1:-1;s.targetVx=N*(a/n)*e.speed,s.targetVy=N*(d/n)*e.speed}const y={idleToWanderingChance:E.IDLE_TO_WANDERING_CHANCE,wanderingMinDuration:E.WANDERING_MIN_DURATION,wanderingToForagingChance:E.WANDERING_TO_FORAGING_CHANCE,wanderingToReturningChance:E.WANDERING_TO_RETURNING_CHANCE,foragingMinDuration:E.FORAGING_MIN_DURATION,foragingToReturningChance:E.FORAGING_TO_RETURNING_CHANCE};function P(s,t,e=y){const r=s.state,i=s.timeInCurrentState;switch(r){case c.IDLE:if(Math.random()<e.idleToWanderingChance*t)return c.WANDERING;break;case c.WANDERING:if(i>=e.wanderingMinDuration){if(Math.random()<e.wanderingToForagingChance*t)return c.FORAGING;if(Math.random()<e.wanderingToReturningChance*t)return c.RETURNING}break;case c.FORAGING:if(i>=e.foragingMinDuration&&Math.random()<e.foragingToReturningChance*t)return c.RETURNING;break;case c.RETURNING:break}return r}function g(s,t){s.state!==t&&(s.state=t,s.timeInCurrentState=0)}class H{constructor(t){this.world=t,this.movementConfig={speed:_.SPEED,changeDirectionInterval:_.CHANGE_DIRECTION_INTERVAL,turnSpeed:_.TURN_SPEED},this.transitionConfig=y}tick(t){const e=this.world.getAllAnts();for(const r of e)this.updateAntBehavior(r,t)}updateAntBehavior(t,e){t.timeSinceDirectionChange+=e,t.timeInCurrentState+=e;const r=this.world.getColony(t.colonyId);if(!r)return;const i=P(t,e,this.transitionConfig);switch(i!==t.state&&g(t,i),t.state){case c.IDLE:t.targetVx=0,t.targetVy=0;break;case c.WANDERING:t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(D(t,this.movementConfig),t.timeSinceDirectionChange=0);break;case c.FORAGING:t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(D(t,this.movementConfig),t.timeSinceDirectionChange=0);break;case c.RETURNING:U(t,r.x,r.y,this.movementConfig),m(t,r.x,r.y,p.HOME_ARRIVAL_DISTANCE)&&g(t,c.IDLE);break}w(t,this.movementConfig,e);const n=v(t,this.world,f.OBSTACLE_DETECTION_RANGE);n&&M(t,n,this.movementConfig),b(t,e),F(t,this.world)}update(t){this.tick(t)}initializeWorld(){const t=this.world.createColony(this.world.width/2,this.world.height/2);for(let e=0;e<G.INITIAL_ANT_COUNT;e++){const r=this.world.spawnAnt(t);D(r,this.movementConfig)}}}class B{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawAnt(e)}drawAnt(t){const e=Math.sqrt(t.vx*t.vx+t.vy*t.vy);let r=0,i=0;if(e>0){const a=t.vx/e,d=t.vy/e;r=a*(l.BODY_RADIUS+l.HEAD_RADIUS),i=d*(l.BODY_RADIUS+l.HEAD_RADIUS)}const n=l.STATE_COLORS[t.state]||l.DEFAULT_BODY_COLOR;this.graphics.fillStyle(n,1),this.graphics.fillCircle(t.x,t.y,l.BODY_RADIUS),this.graphics.fillStyle(l.HEAD_COLOR,1),this.graphics.fillCircle(t.x+r,t.y+i,l.HEAD_RADIUS)}destroy(){this.graphics.destroy()}}class W{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawColony(e)}drawColony(t){this.graphics.fillStyle(h.NEST_COLOR,h.NEST_OPACITY),this.graphics.fillCircle(t.x,t.y,h.NEST_RADIUS),this.graphics.lineStyle(h.NEST_BORDER_WIDTH,h.NEST_BORDER_COLOR,1),this.graphics.strokeCircle(t.x,t.y,h.NEST_RADIUS),this.graphics.fillStyle(h.ENTRANCE_COLOR,h.ENTRANCE_OPACITY),this.graphics.fillCircle(t.x,t.y,h.NEST_RADIUS*h.ENTRANCE_RADIUS_MULTIPLIER)}destroy(){this.graphics.destroy()}}class V{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.graphics.fillStyle(4868682,1),this.graphics.fillCircle(e.x,e.y,e.radius),this.graphics.lineStyle(2,0,1),this.graphics.strokeCircle(e.x,e.y,e.radius)}destroy(){this.graphics.destroy()}}class I{constructor(t,e,r){this.x=t,this.y=e,this.radius=r}containsPoint(t,e){const r=t-this.x,i=e-this.y;return r*r+i*i<=this.radius*this.radius}distanceToEdge(t,e){const r=t-this.x,i=e-this.y;return Math.sqrt(r*r+i*i)-this.radius}}class Y extends O.Scene{constructor(){super({key:"MainScene"})}create(){this.cameras.main.setBackgroundColor(R.BACKGROUND_COLOR);const t=this.scale.width,e=this.scale.height;this.world=new L(t,e),this.simulationSystem=new H(this.world),this.simulationSystem.initializeWorld(),this.addTestObstacles(),this.antRenderer=new B(this),this.colonyRenderer=new W(this),this.obstacleRenderer=new V(this),this.add.text(o.TITLE.X,o.TITLE.Y,o.TITLE.TEXT,{fontSize:o.TITLE.FONT_SIZE,color:o.TITLE.COLOR,fontStyle:"bold"}).setDepth(o.UI_DEPTH),this.add.text(o.INSTRUCTIONS.X,o.INSTRUCTIONS.Y,o.INSTRUCTIONS.TEXT,{fontSize:o.INSTRUCTIONS.FONT_SIZE,color:o.INSTRUCTIONS.COLOR}).setDepth(o.UI_DEPTH),this.add.text(o.LEGEND.X,o.LEGEND.Y,o.LEGEND.TEXT,{fontSize:o.LEGEND.FONT_SIZE,color:o.LEGEND.COLOR}).setDepth(o.UI_DEPTH),this.debugText=this.add.text(o.DEBUG.X,this.scale.height-o.DEBUG.Y_OFFSET_FROM_BOTTOM,"",{fontSize:o.DEBUG.FONT_SIZE,color:o.DEBUG.COLOR,backgroundColor:o.DEBUG.BACKGROUND_COLOR,padding:o.DEBUG.PADDING}).setDepth(o.UI_DEPTH)}update(t,e){const r=e/1e3;this.simulationSystem.update(r),this.obstacleRenderer.render(this.world.getObstacles()),this.colonyRenderer.render(this.world.getColonies());const i=this.world.getAllAnts();this.antRenderer.render(i),this.updateDebugUI(i)}updateDebugUI(t){const e={[c.IDLE]:0,[c.WANDERING]:0,[c.FORAGING]:0,[c.RETURNING]:0};for(const i of t)e[i.state]++;const r=[`Total: ${t.length}`,`Idle: ${e[c.IDLE]}`,`Wandering: ${e[c.WANDERING]}`,`Foraging: ${e[c.FORAGING]}`,`Returning: ${e[c.RETURNING]}`].join(" | ");this.debugText.setText(r)}addTestObstacles(){const t=this.scale.width/2,e=this.scale.height/2;this.world.addObstacle(new I(t/2,e/2,35)),this.world.addObstacle(new I(t*1.5,e/2,30)),this.world.addObstacle(new I(t/2,e*1.5,40)),this.world.addObstacle(new I(t*1.5,e*1.5,45)),this.world.addObstacle(new I(150,e,25))}shutdown(){this.antRenderer.destroy(),this.colonyRenderer.destroy(),this.obstacleRenderer.destroy()}}const X={type:O.AUTO,width:R.CANVAS_WIDTH,height:R.CANVAS_HEIGHT,parent:"game-container",backgroundColor:R.BACKGROUND_COLOR,scene:[Y],scale:{mode:O.Scale.FIT,autoCenter:O.Scale.CENTER_BOTH}};new O.Game(X);
