import{P as D}from"./phaser-0RJB29YE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var c=(r=>(r.IDLE="IDLE",r.WANDERING="WANDERING",r.FORAGING="FORAGING",r.RETURNING="RETURNING",r))(c||{});class P{constructor(t,e,s,i,o=100){this.id=t,this.x=e,this.y=s,this.vx=0,this.vy=0,this.targetVx=0,this.targetVy=0,this.state=c.IDLE,this.colonyId=i,this.timeSinceDirectionChange=0,this.timeInCurrentState=0,this.perceptionRange=o}}const u={CANVAS_WIDTH:1024,CANVAS_HEIGHT:768,BACKGROUND_COLOR:"#2d4a2e"},F={INITIAL_ANT_COUNT:20},_={SPEED:50,CHANGE_DIRECTION_INTERVAL:2,TURN_SPEED:.3},I={IDLE_TO_WANDERING_CHANCE:.5,WANDERING_MIN_DURATION:3,WANDERING_TO_FORAGING_CHANCE:.1,WANDERING_TO_RETURNING_CHANCE:.05,FORAGING_MIN_DURATION:5,FORAGING_TO_RETURNING_CHANCE:.1},M={HOME_ARRIVAL_DISTANCE:15},S={OBSTACLE_DETECTION_RANGE:80,PERCEPTION_RANGE:100},N={BODY_RADIUS:3,HEAD_RADIUS:2,HEAD_COLOR:6636321,STATE_COLORS:{IDLE:8421504,WANDERING:9127187,FORAGING:4881486,RETURNING:4286881},DEFAULT_BODY_COLOR:9127187},v={PHEROMONE_DEPTH:5},E={NEST_RADIUS:20,NEST_COLOR:7356948,NEST_BORDER_COLOR:9127187,NEST_BORDER_WIDTH:2,NEST_OPACITY:.6,ENTRANCE_RADIUS_MULTIPLIER:.4,ENTRANCE_COLOR:0,ENTRANCE_OPACITY:.3},h={TITLE:{X:16,Y:16,FONT_SIZE:"32px",COLOR:"#ffffff",TEXT:"Ants!"},INSTRUCTIONS:{X:16,Y:56,FONT_SIZE:"16px",COLOR:"#cccccc",TEXT:"Watch the ants wander and return home..."},LEGEND:{X:16,Y:84,FONT_SIZE:"12px",COLOR:"#aaaaaa",TEXT:"Colors: Gray=Idle, Brown=Wandering, Green=Foraging, Blue=Returning"},DEBUG:{X:16,Y_OFFSET_FROM_BOTTOM:40,FONT_SIZE:"14px",COLOR:"#ffffff",BACKGROUND_COLOR:"#00000088",PADDING:{x:8,y:4}},UI_DEPTH:100},l={GRID_CELL_SIZE:1,FOOD_DECAY_RATE:.1,NEST_DECAY_RATE:.05,DANGER_DECAY_RATE:.15,MAX_STRENGTH:10,MIN_STRENGTH:.001,RENDER_THRESHOLD:.01,VISUALIZATION_POWER:.5,MAX_OPACITY:.6,COLORS:{FOOD:16711680,NEST:255,DANGER:16776960}};class H{constructor(t,e,s){this.id=t,this.x=e,this.y=s,this.ants=[],this.resourceCount=0}spawnAnt(t){const e=new P(t,this.x,this.y,this.id,S.PERCEPTION_RANGE);return this.ants.push(e),e}getAnts(){return[...this.ants]}getAntCount(){return this.ants.length}}var d=(r=>(r.FOOD="FOOD",r.NEST="NEST",r.DANGER="DANGER",r))(d||{});class W{constructor(t,e,s){this.width=t,this.height=e,this.cellSize=s,this.gridWidth=Math.ceil(t/s),this.gridHeight=Math.ceil(e/s),this.grids=new Map;for(const i of Object.values(d))this.grids.set(i,new Float32Array(this.gridWidth*this.gridHeight))}deposit(t,e,s,i){const o=Math.floor(t/this.cellSize),n=Math.floor(e/this.cellSize);if(o<0||o>=this.gridWidth||n<0||n>=this.gridHeight)return;const a=this.grids.get(s);if(!a)return;const O=n*this.gridWidth+o;a[O]=Math.min(a[O]+i,l.MAX_STRENGTH)}sample(t,e,s){const i=Math.floor(t/this.cellSize),o=Math.floor(e/this.cellSize);if(i<0||i>=this.gridWidth||o<0||o>=this.gridHeight)return 0;const n=this.grids.get(s);if(!n)return 0;const a=o*this.gridWidth+i;return n[a]}decay(t,e,s){const i=this.grids.get(s);if(!i)return;const o=Math.pow(1-e,t);for(let n=0;n<i.length;n++)i[n]*=o,i[n]<l.MIN_STRENGTH&&(i[n]=0)}getGrid(t){return this.grids.get(t)}getGridWidth(){return this.gridWidth}getGridHeight(){return this.gridHeight}getCellSize(){return this.cellSize}clear(){for(const t of this.grids.values())t.fill(0)}clearType(t){const e=this.grids.get(t);e&&e.fill(0)}}class Y{constructor(t,e){this.width=t,this.height=e,this.colonies=[],this.obstacles=[],this.pheromoneGrid=new W(t,e,l.GRID_CELL_SIZE),this.nextAntId=0,this.cachedAnts=[],this.antsCacheDirty=!0}createColony(t,e){const s=this.colonies.length,i=new H(s,t,e);return this.colonies.push(i),i}spawnAnt(t){const e=t.spawnAnt(this.nextAntId++);return this.antsCacheDirty=!0,e}getAllAnts(){if(this.antsCacheDirty){this.cachedAnts=[];for(const t of this.colonies)this.cachedAnts.push(...t.getAnts());this.antsCacheDirty=!1}return this.cachedAnts}getColonies(){return[...this.colonies]}getColony(t){return this.colonies[t]}addObstacle(t){this.obstacles.push(t)}getObstacles(){return this.obstacles}getObstaclesNear(t,e,s){const i=[];for(const o of this.obstacles){const n=o.x-t,a=o.y-e;Math.sqrt(n*n+a*a)-o.radius<=s&&i.push(o)}return i}}function p(r,t){const e=Math.random()*Math.PI*2;r.targetVx=Math.cos(e)*t.speed,r.targetVy=Math.sin(e)*t.speed}function B(r,t,e,s){const i=t-r.x,o=e-r.y,n=Math.sqrt(i*i+o*o);n>0&&(r.targetVx=i/n*s.speed,r.targetVy=o/n*s.speed)}function V(r,t,e,s=10){const i=t-r.x,o=e-r.y;return i*i+o*o<s*s}function X(r,t,e){const s=Math.min(1,t.turnSpeed*e*10);r.vx+=(r.targetVx-r.vx)*s,r.vy+=(r.targetVy-r.vy)*s}function k(r,t){r.x+=r.vx*t,r.y+=r.vy*t}function z(r,t){(r.x<0||r.x>t.width)&&(r.vx*=-1,r.x=Math.max(0,Math.min(t.width,r.x))),(r.y<0||r.y>t.height)&&(r.vy*=-1,r.y=Math.max(0,Math.min(t.height,r.y)))}function Z(r,t,e){const s=t.getObstaclesNear(r.x,r.y,e);if(s.length===0)return null;let i=null,o=1/0;const n=Math.sqrt(r.vx*r.vx+r.vy*r.vy);if(n===0)return null;const a=r.vx/n,O=r.vy/n;for(const R of s){const C=R.x-r.x,T=R.y-r.y,g=Math.sqrt(C*C+T*T);(C*a+T*O)/g>.5&&g<o&&(o=g,i=R)}return i}function q(r,t,e){const s=t.x-r.x,i=t.y-r.y,o=Math.sqrt(s*s+i*i);if(o===0)return;const n=-i,a=s,R=(r.vx*n+r.vy*a)/o>=0?1:-1;r.targetVx=R*(n/o)*e.speed,r.targetVy=R*(a/o)*e.speed}const m={idleToWanderingChance:I.IDLE_TO_WANDERING_CHANCE,wanderingMinDuration:I.WANDERING_MIN_DURATION,wanderingToForagingChance:I.WANDERING_TO_FORAGING_CHANCE,wanderingToReturningChance:I.WANDERING_TO_RETURNING_CHANCE,foragingMinDuration:I.FORAGING_MIN_DURATION,foragingToReturningChance:I.FORAGING_TO_RETURNING_CHANCE};function K(r,t,e=m){const s=r.state,i=r.timeInCurrentState;switch(s){case c.IDLE:if(Math.random()<e.idleToWanderingChance*t)return c.WANDERING;break;case c.WANDERING:if(i>=e.wanderingMinDuration){if(Math.random()<e.wanderingToForagingChance*t)return c.FORAGING;if(Math.random()<e.wanderingToReturningChance*t)return c.RETURNING}break;case c.FORAGING:if(i>=e.foragingMinDuration&&Math.random()<e.foragingToReturningChance*t)return c.RETURNING;break;case c.RETURNING:break}return s}function G(r,t){r.state!==t&&(r.state=t,r.timeInCurrentState=0)}class ${constructor(t){this.world=t,this.movementConfig={speed:_.SPEED,changeDirectionInterval:_.CHANGE_DIRECTION_INTERVAL,turnSpeed:_.TURN_SPEED},this.transitionConfig=m}tick(t){const e=this.world.getAllAnts();for(const s of e)this.updateAntBehavior(s,t);this.world.pheromoneGrid.decay(t,l.FOOD_DECAY_RATE,d.FOOD),this.world.pheromoneGrid.decay(t,l.NEST_DECAY_RATE,d.NEST),this.world.pheromoneGrid.decay(t,l.DANGER_DECAY_RATE,d.DANGER)}updateAntBehavior(t,e){t.timeSinceDirectionChange+=e,t.timeInCurrentState+=e;const s=this.world.getColony(t.colonyId);if(!s)return;const i=K(t,e,this.transitionConfig);switch(i!==t.state&&G(t,i),t.state){case c.IDLE:t.targetVx=0,t.targetVy=0;break;case c.WANDERING:t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(p(t,this.movementConfig),t.timeSinceDirectionChange=0);break;case c.FORAGING:t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(p(t,this.movementConfig),t.timeSinceDirectionChange=0);break;case c.RETURNING:B(t,s.x,s.y,this.movementConfig),V(t,s.x,s.y,M.HOME_ARRIVAL_DISTANCE)&&G(t,c.IDLE);break}X(t,this.movementConfig,e);const o=Z(t,this.world,S.OBSTACLE_DETECTION_RANGE);o&&q(t,o,this.movementConfig),k(t,e),z(t,this.world)}update(t){this.tick(t)}initializeWorld(){const t=this.world.createColony(this.world.width/2,this.world.height/2);for(let e=0;e<F.INITIAL_ANT_COUNT;e++){const s=this.world.spawnAnt(t);p(s,this.movementConfig)}}}class j{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawAnt(e)}drawAnt(t){const e=Math.sqrt(t.vx*t.vx+t.vy*t.vy);let s=0,i=0;if(e>0){const n=t.vx/e,a=t.vy/e;s=n*(N.BODY_RADIUS+N.HEAD_RADIUS),i=a*(N.BODY_RADIUS+N.HEAD_RADIUS)}const o=N.STATE_COLORS[t.state]||N.DEFAULT_BODY_COLOR;this.graphics.fillStyle(o,1),this.graphics.fillCircle(t.x,t.y,N.BODY_RADIUS),this.graphics.fillStyle(N.HEAD_COLOR,1),this.graphics.fillCircle(t.x+s,t.y+i,N.HEAD_RADIUS)}destroy(){this.graphics.destroy()}}class J{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawColony(e)}drawColony(t){this.graphics.fillStyle(E.NEST_COLOR,E.NEST_OPACITY),this.graphics.fillCircle(t.x,t.y,E.NEST_RADIUS),this.graphics.lineStyle(E.NEST_BORDER_WIDTH,E.NEST_BORDER_COLOR,1),this.graphics.strokeCircle(t.x,t.y,E.NEST_RADIUS),this.graphics.fillStyle(E.ENTRANCE_COLOR,E.ENTRANCE_OPACITY),this.graphics.fillCircle(t.x,t.y,E.NEST_RADIUS*E.ENTRANCE_RADIUS_MULTIPLIER)}destroy(){this.graphics.destroy()}}class Q{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.graphics.fillStyle(4868682,1),this.graphics.fillCircle(e.x,e.y,e.radius),this.graphics.lineStyle(2,0,1),this.graphics.strokeCircle(e.x,e.y,e.radius)}destroy(){this.graphics.destroy()}}class tt{constructor(t){this.scene=t,this.graphics=t.add.graphics(),this.graphics.setDepth(v.PHEROMONE_DEPTH),this.visible=!1,this.graphics.setVisible(!1)}render(t){if(!this.visible)return;this.graphics.clear();const e=t.getGridWidth(),s=t.getGridHeight(),i=t.getCellSize();this.renderPheromoneType(t,d.NEST,e,s,i,l.COLORS.NEST),this.renderPheromoneType(t,d.FOOD,e,s,i,l.COLORS.FOOD),this.renderPheromoneType(t,d.DANGER,e,s,i,l.COLORS.DANGER)}renderPheromoneType(t,e,s,i,o,n){const a=t.getGrid(e);if(!a)return;const O=n>>16&255,R=n>>8&255,C=n&255;for(let T=0;T<i;T++)for(let g=0;g<s;g++){const f=T*s+g,y=a[f];if(y>l.RENDER_THRESHOLD){const x=Math.min(y/l.MAX_STRENGTH,1),L=Math.pow(x,l.VISUALIZATION_POWER)*l.MAX_OPACITY,w=g*o,b=T*o,U=D.Display.Color.GetColor(O,R,C);this.graphics.fillStyle(U,L),this.graphics.fillRect(w,b,o,o)}}}toggle(){this.visible=!this.visible,this.graphics.setVisible(this.visible),this.visible||this.graphics.clear()}setVisible(t){this.visible=t,this.graphics.setVisible(t),t||this.graphics.clear()}isVisible(){return this.visible}destroy(){this.graphics.destroy()}}class A{constructor(t,e,s){this.x=t,this.y=e,this.radius=s}containsPoint(t,e){const s=t-this.x,i=e-this.y;return s*s+i*i<=this.radius*this.radius}distanceToEdge(t,e){const s=t-this.x,i=e-this.y;return Math.sqrt(s*s+i*i)-this.radius}}class et extends D.Scene{constructor(){super({key:"MainScene"})}create(){var s,i,o;this.cameras.main.setBackgroundColor(u.BACKGROUND_COLOR);const t=this.scale.width,e=this.scale.height;this.world=new Y(t,e),this.simulationSystem=new $(this.world),this.simulationSystem.initializeWorld(),this.addTestObstacles(),this.antRenderer=new j(this),this.colonyRenderer=new J(this),this.obstacleRenderer=new Q(this),this.pheromoneRenderer=new tt(this),this.add.text(h.TITLE.X,h.TITLE.Y,h.TITLE.TEXT,{fontSize:h.TITLE.FONT_SIZE,color:h.TITLE.COLOR,fontStyle:"bold"}).setDepth(h.UI_DEPTH),this.add.text(h.INSTRUCTIONS.X,h.INSTRUCTIONS.Y,h.INSTRUCTIONS.TEXT,{fontSize:h.INSTRUCTIONS.FONT_SIZE,color:h.INSTRUCTIONS.COLOR}).setDepth(h.UI_DEPTH),this.add.text(h.LEGEND.X,h.LEGEND.Y,h.LEGEND.TEXT,{fontSize:h.LEGEND.FONT_SIZE,color:h.LEGEND.COLOR}).setDepth(h.UI_DEPTH),this.pheromoneOverlayText=this.add.text(h.LEGEND.X,h.LEGEND.Y+20,"Press P to toggle pheromone overlay | Press T for test pattern",{fontSize:h.LEGEND.FONT_SIZE,color:h.LEGEND.COLOR}).setDepth(h.UI_DEPTH),this.debugText=this.add.text(h.DEBUG.X,this.scale.height-h.DEBUG.Y_OFFSET_FROM_BOTTOM,"",{fontSize:h.DEBUG.FONT_SIZE,color:h.DEBUG.COLOR,backgroundColor:h.DEBUG.BACKGROUND_COLOR,padding:h.DEBUG.PADDING}).setDepth(h.UI_DEPTH),(s=this.input.keyboard)==null||s.on("keydown-P",()=>{this.pheromoneRenderer.toggle(),this.updatePheromoneOverlayText()}),(i=this.input.keyboard)==null||i.on("keydown-T",()=>{this.depositTestPheromones()}),(o=this.input.mouse)==null||o.disableContextMenu()}update(t,e){const s=e/1e3;this.simulationSystem.update(s),this.pheromoneRenderer.isVisible()&&this.pheromoneRenderer.render(this.world.pheromoneGrid),this.obstacleRenderer.render(this.world.getObstacles()),this.colonyRenderer.render(this.world.getColonies());const i=this.world.getAllAnts();this.antRenderer.render(i),this.updateDebugUI(i),this.handleTestPheromoneDeposition()}updatePheromoneOverlayText(){const t=this.pheromoneRenderer.isVisible()?"ON":"OFF";this.pheromoneOverlayText.setText(`Press P to toggle pheromone overlay (${t}) | Press T for test pattern`)}handleTestPheromoneDeposition(){const t=this.input.activePointer;t.leftButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,d.FOOD,.5),t.rightButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,d.NEST,.5),t.middleButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,d.DANGER,.5)}depositTestPheromones(){const t=this.scale.width/2,e=this.scale.height/2;for(let s=0;s<150;s++)this.world.pheromoneGrid.deposit(t-75+s,e-100,d.FOOD,3);for(let s=0;s<150;s++)this.world.pheromoneGrid.deposit(t-75+s,e,d.NEST,3);for(let s=0;s<60;s++)for(let i=0;i<60;i++)this.world.pheromoneGrid.deposit(t-30+s,e+50+i,d.DANGER,2);console.log("Test pheromones deposited! You should see red, blue, and yellow patterns.")}updateDebugUI(t){const e={[c.IDLE]:0,[c.WANDERING]:0,[c.FORAGING]:0,[c.RETURNING]:0};for(const i of t)e[i.state]++;const s=[`Total: ${t.length}`,`Idle: ${e[c.IDLE]}`,`Wandering: ${e[c.WANDERING]}`,`Foraging: ${e[c.FORAGING]}`,`Returning: ${e[c.RETURNING]}`].join(" | ");this.debugText.setText(s)}addTestObstacles(){const t=this.scale.width/2,e=this.scale.height/2;this.world.addObstacle(new A(t/2,e/2,35)),this.world.addObstacle(new A(t*1.5,e/2,30)),this.world.addObstacle(new A(t/2,e*1.5,40)),this.world.addObstacle(new A(t*1.5,e*1.5,45)),this.world.addObstacle(new A(150,e,25))}shutdown(){this.antRenderer.destroy(),this.colonyRenderer.destroy(),this.obstacleRenderer.destroy(),this.pheromoneRenderer.destroy()}}const st={type:D.AUTO,width:u.CANVAS_WIDTH,height:u.CANVAS_HEIGHT,parent:"game-container",backgroundColor:u.BACKGROUND_COLOR,scene:[et],scale:{mode:D.Scale.FIT,autoCenter:D.Scale.CENTER_BOTH}};new D.Game(st);
