import{P as A}from"./phaser-0RJB29YE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();var E=(o=>(o.IDLE="IDLE",o.WANDERING="WANDERING",o.FORAGING="FORAGING",o.RETURNING="RETURNING",o))(E||{});class k{constructor(t,e,s,i,r=100){this.carriedFood=0,this.energy=100,this.lastEnergyConsumption=0,this.id=t,this.x=e,this.y=s,this.vx=0,this.vy=0,this.targetVx=0,this.targetVy=0,this.state=E.IDLE,this.colonyId=i,this.timeSinceDirectionChange=0,this.timeInCurrentState=0,this.perceptionRange=r,this.energy=100,this.lastEnergyConsumption=0}}const y={CANVAS_WIDTH:1024,CANVAS_HEIGHT:768,BACKGROUND_COLOR:"#2d4a2e"},z={INITIAL_ANT_COUNT:40},m={SPEED:50,CHANGE_DIRECTION_INTERVAL:2,TURN_SPEED:.3},O={MAX_ENERGY:100,CONSUMPTION_RATES:{IDLE:.5,WANDERING:1,FORAGING:1.5,RETURNING:1},THRESHOLDS:{HUNGER:50},SPEED_MULTIPLIERS:{WELL_FED:1,NORMAL:.95,HUNGRY:.7,STARVING:.3},HUNGER_RETURN_CHANCE:.5,FOOD_CONSUMPTION_RATE:.2,ENERGY_PER_FOOD_UNIT:100},D={IDLE_TO_WANDERING_CHANCE:.5,WANDERING_MIN_DURATION:5,WANDERING_TO_FORAGING_CHANCE:.1,WANDERING_TO_RETURNING_CHANCE:.02,FORAGING_MIN_DURATION:5,FORAGING_TO_RETURNING_CHANCE:.1},G={HOME_ARRIVAL_DISTANCE:15,ENTRANCE_RADIUS:30,METRICS_SMOOTHING_FACTOR:.2,SAFETY_FOOD_PER_ANT:.2},M={OBSTACLE_DETECTION_RANGE:80,PERCEPTION_RANGE:100},T={BODY_RADIUS:3,HEAD_RADIUS:2,HEAD_COLOR:6636321,STATE_COLORS:{IDLE:8421504,WANDERING:9127187,FORAGING:4881486,RETURNING:4286881},DEFAULT_BODY_COLOR:9127187},q={PHEROMONE_DEPTH:5},f={NEST_RADIUS:20,NEST_COLOR:7356948,NEST_BORDER_COLOR:9127187,NEST_BORDER_WIDTH:2,NEST_OPACITY:.6,ENTRANCE_RADIUS_MULTIPLIER:.4,ENTRANCE_COLOR:0,ENTRANCE_OPACITY:.3},c={TITLE:{X:16,Y:16,FONT_SIZE:"32px",COLOR:"#ffffff",TEXT:"Ants!"},INSTRUCTIONS:{X:16,Y:56,FONT_SIZE:"16px",COLOR:"#cccccc",TEXT:"Watch the ants wander and return home..."},LEGEND:{X:16,Y:84,FONT_SIZE:"12px",COLOR:"#aaaaaa",TEXT:"Colors: Gray=Idle, Brown=Wandering, Green=Foraging, Blue=Returning"},DEBUG:{X:16,Y_OFFSET_FROM_BOTTOM:40,FONT_SIZE:"14px",COLOR:"#ffffff",BACKGROUND_COLOR:"#00000088",PADDING:{x:8,y:4}},UI_DEPTH:100},R={GRID_CELL_SIZE:1,FOOD_DECAY_RATE:.05,NEST_DECAY_RATE:.03,DANGER_DECAY_RATE:.1,DEPOSITION_WANDERING:.5,DEPOSITION_FORAGING:.5,DEPOSITION_RETURNING:2,DIFFUSION_UPDATE_INTERVAL:3,DIFFUSION_RATE:.05,MAX_STRENGTH:20,MIN_STRENGTH:.001,RENDER_THRESHOLD:.01,VISUALIZATION_POWER:.5,MAX_OPACITY:.6,COLORS:{FOOD:16711680,NEST:255,DANGER:16776960}},S={SAMPLE_DISTANCE:80,FOLLOW_STRENGTH:.6,EXPLORATION_RANDOMNESS:.08,GRADIENT_THRESHOLD:.005},g={INITIAL_FOOD_AMOUNT:100,SOURCE_RADIUS:15,HARVEST_RATE:1,HARVEST_DISTANCE:20,SPAWN_EDGE_PADDING:30,SPAWN_ATTEMPTS:10,SPAWN_BUFFER_DISTANCE:15},C={MAX_CAPACITY:5,CARRYING_INDICATOR_RADIUS:1.5,CARRYING_INDICATOR_COLOR:16729156},U={FOOD_COLOR:13935988,FOOD_BORDER_COLOR:9137991};class ${constructor(t,e,s){this.id=t,this.x=e,this.y=s,this.ants=[],this.foodStored=0,this.foodConsumedRate=0,this.foodGatheredRate=0,this.surplusRate=0,this.gatheredThisFrame=0,this.consumedThisFrame=0}spawnAnt(t){const e=new k(t,this.x,this.y,this.id,M.PERCEPTION_RANGE);return this.ants.push(e),e}beginFrame(){this.gatheredThisFrame=0,this.consumedThisFrame=0}addFood(t){t<=0||(this.foodStored+=t,this.gatheredThisFrame+=t)}consumeFood(t){if(t<=0||this.foodStored<=0)return 0;const e=Math.min(t,this.foodStored);return this.foodStored-=e,this.consumedThisFrame+=e,e}finalizeFrame(t){const e=Math.max(t,1e-4),s=this.gatheredThisFrame/e,i=this.consumedThisFrame/e,r=G.METRICS_SMOOTHING_FACTOR;this.foodGatheredRate=this.lerp(this.foodGatheredRate,s,r),this.foodConsumedRate=this.lerp(this.foodConsumedRate,i,r),this.surplusRate=this.foodGatheredRate-this.foodConsumedRate}getHealthStatus(){const t=this.getPopulation();if(t===0)return"dead";if(this.foodStored===0)return"critical";const e=t*G.SAFETY_FOOD_PER_ANT;return this.foodStored<e?"struggling":"healthy"}getAverageEnergy(){const t=this.ants;return t.length===0?0:t.reduce((s,i)=>s+i.energy,0)/t.length}getAnts(){return[...this.ants]}getAntCount(){return this.ants.length}getPopulation(){return this.ants.length}lerp(t,e,s){return t+(e-t)*s}}class w{constructor(t,e,s,i,r){this.id=t,this.x=e,this.y=s,this.foodAmount=i,this.radius=r}harvest(t){const e=Math.min(t,this.foodAmount);return this.foodAmount-=e,e}isDepleted(){return this.foodAmount<=0}}var N=(o=>(o.FOOD="FOOD",o.NEST="NEST",o.DANGER="DANGER",o))(N||{});class Z{constructor(t,e,s){this.width=t,this.height=e,this.cellSize=s,this.gridWidth=Math.ceil(t/s),this.gridHeight=Math.ceil(e/s),this.grids=new Map;for(const i of Object.values(N))this.grids.set(i,new Float32Array(this.gridWidth*this.gridHeight));this.diffusionBuffer=new Float32Array(this.gridWidth*this.gridHeight)}deposit(t,e,s,i){const r=Math.floor(t/this.cellSize),n=Math.floor(e/this.cellSize);if(r<0||r>=this.gridWidth||n<0||n>=this.gridHeight)return;const h=this.grids.get(s);if(!h)return;const d=n*this.gridWidth+r;h[d]=Math.min(h[d]+i,R.MAX_STRENGTH)}sample(t,e,s){const i=Math.floor(t/this.cellSize),r=Math.floor(e/this.cellSize);if(i<0||i>=this.gridWidth||r<0||r>=this.gridHeight)return 0;const n=this.grids.get(s);if(!n)return 0;const h=r*this.gridWidth+i;return n[h]}decay(t,e,s){const i=this.grids.get(s);if(!i)return;const r=Math.pow(1-e,t);for(let n=0;n<i.length;n++)i[n]*=r,i[n]<R.MIN_STRENGTH&&(i[n]=0)}getGrid(t){return this.grids.get(t)}getGridWidth(){return this.gridWidth}getGridHeight(){return this.gridHeight}getCellSize(){return this.cellSize}diffuse(t,e){const s=this.grids.get(t);if(s){this.diffusionBuffer.fill(0);for(let i=0;i<this.gridHeight;i++)for(let r=0;r<this.gridWidth;r++){const n=i*this.gridWidth+r,h=s[n];let d=h,l=1;i>0&&(d+=s[(i-1)*this.gridWidth+r],l++),i<this.gridHeight-1&&(d+=s[(i+1)*this.gridWidth+r],l++),r>0&&(d+=s[i*this.gridWidth+(r-1)],l++),r<this.gridWidth-1&&(d+=s[i*this.gridWidth+(r+1)],l++);const a=d/l;this.diffusionBuffer[n]=h*(1-e)+a*e,this.diffusionBuffer[n]<R.MIN_STRENGTH&&(this.diffusionBuffer[n]=0)}s.set(this.diffusionBuffer)}}clear(){for(const t of this.grids.values())t.fill(0)}clearType(t){const e=this.grids.get(t);e&&e.fill(0)}}class j{constructor(t,e){this.foodSource=null,this.width=t,this.height=e,this.colonies=[],this.obstacles=[],this.pheromoneGrid=new Z(t,e,R.GRID_CELL_SIZE),this.nextAntId=0,this.nextFoodSourceId=0,this.cachedAnts=[],this.antsCacheDirty=!0}createColony(t,e){const s=this.colonies.length,i=new $(s,t,e);return this.colonies.push(i),i}spawnAnt(t){const e=t.spawnAnt(this.nextAntId++);return this.antsCacheDirty=!0,e}removeAnt(t){const e=this.getColony(t.colonyId);if(!e)return;const s=e.ants.indexOf(t);s!==-1&&(e.ants.splice(s,1),this.antsCacheDirty=!0)}getAllAnts(){if(this.antsCacheDirty){this.cachedAnts=[];for(const t of this.colonies)this.cachedAnts.push(...t.getAnts());this.antsCacheDirty=!1}return this.cachedAnts}getColonies(){return[...this.colonies]}getColony(t){return this.colonies[t]}addObstacle(t){this.obstacles.push(t)}getObstacles(){return this.obstacles}getObstaclesNear(t,e,s){const i=[];for(const r of this.obstacles){const n=r.x-t,h=r.y-e;Math.sqrt(n*n+h*h)-r.radius<=s&&i.push(r)}return i}spawnFoodSource(){const t=g.SOURCE_RADIUS,e=g.SPAWN_EDGE_PADDING,s=g.SPAWN_ATTEMPTS;for(let h=0;h<s;h++){const d=e+Math.random()*(this.width-2*e),l=e+Math.random()*(this.height-2*e);if(this.isValidFoodSourceLocation(d,l,t)){const a=new w(`food_${this.nextFoodSourceId++}`,d,l,g.INITIAL_FOOD_AMOUNT,t);return this.foodSource=a,a}}const i=this.width-t-e,r=this.height-t-e,n=new w(`food_${this.nextFoodSourceId++}`,i,r,g.INITIAL_FOOD_AMOUNT,t);return this.foodSource=n,n}isValidFoodSourceLocation(t,e,s){const i=s+g.SPAWN_BUFFER_DISTANCE;for(const r of this.obstacles){const n=r.x-t,h=r.y-e;if(Math.sqrt(n*n+h*h)<i+r.radius)return!1}for(const r of this.colonies){const n=r.x-t,h=r.y-e;if(Math.sqrt(n*n+h*h)<i+G.ENTRANCE_RADIUS)return!1}return!0}getFoodSourcesNear(t,e,s){if(!this.foodSource)return[];const i=this.foodSource.x-t,r=this.foodSource.y-e;return Math.sqrt(i*i+r*r)<=s?[this.foodSource]:[]}}const v=[0,Math.PI/4,Math.PI/2,3*Math.PI/4,Math.PI,-3*Math.PI/4,-Math.PI/2,-Math.PI/4];function F(o,t,e,s){const i=[];let r=0;for(const h of v){const d=o.x+Math.cos(h)*s,l=o.y+Math.sin(h)*s,a=t.sample(d,l,e);i.push(a),a>r&&(r=a)}const n=Math.min(r,1);return{samples:i,maxConcentration:n}}function K(o,t=.01){if(o.maxConcentration<t)return null;let e=0,s=o.samples[0];for(let i=1;i<o.samples.length;i++)o.samples[i]>s&&(s=o.samples[i],e=i);return v[e]}function J(o,t,e,s){if(t===null||Math.random()<s.explorationRandomness){const a=Math.random()*Math.PI*2,I=Math.cos(a)*e,u=Math.sin(a)*e;o.targetVx=I,o.targetVy=u;return}const i=Math.cos(t)*e,r=Math.sin(t)*e,n=s.followStrength,h=(Math.random()-.5)*Math.PI*.2,d=Math.cos(h)*e*(1-n)*.3,l=Math.sin(h)*e*(1-n)*.3;o.targetVx=i*n+d,o.targetVy=r*n+l}function p(o,t){const e=Math.random()*Math.PI*2;o.targetVx=Math.cos(e)*t.speed,o.targetVy=Math.sin(e)*t.speed}function H(o,t,e,s){const i=t-o.x,r=e-o.y,n=Math.sqrt(i*i+r*r);n>0&&(o.targetVx=i/n*s.speed,o.targetVy=r/n*s.speed)}function Q(o,t,e,s=10){const i=t-o.x,r=e-o.y;return i*i+r*r<s*s}function tt(o,t,e){const s=Math.min(1,t.turnSpeed*e*10);o.vx+=(o.targetVx-o.vx)*s,o.vy+=(o.targetVy-o.vy)*s}function et(o,t){o.x+=o.vx*t,o.y+=o.vy*t}function st(o,t){(o.x<0||o.x>t.width)&&(o.vx*=-1,o.x=Math.max(0,Math.min(t.width,o.x))),(o.y<0||o.y>t.height)&&(o.vy*=-1,o.y=Math.max(0,Math.min(t.height,o.y)))}function it(o,t,e){const s=t.getObstaclesNear(o.x,o.y,e);if(s.length===0)return null;let i=null,r=1/0;const n=Math.sqrt(o.vx*o.vx+o.vy*o.vy);if(n===0)return null;const h=o.vx/n,d=o.vy/n;for(const l of s){const a=l.x-o.x,I=l.y-o.y,u=Math.sqrt(a*a+I*I);(a*h+I*d)/u>.5&&u<r&&(r=u,i=l)}return i}function ot(o,t,e){const s=t.x-o.x,i=t.y-o.y,r=Math.sqrt(s*s+i*i);if(r===0)return;const n=-i,h=s,l=(o.vx*n+o.vy*h)/r>=0?1:-1;o.targetVx=l*(n/r)*e.speed,o.targetVy=l*(h/r)*e.speed}function rt(o,t){const e=t.getObstaclesNear(o.x,o.y,100);for(const s of e)if(s.containsPoint(o.x,o.y)){const i=o.x-s.x,r=o.y-s.y,n=Math.sqrt(i*i+r*r);if(n===0){const d=Math.random()*Math.PI*2;o.x=s.x+Math.cos(d)*(s.radius+1),o.y=s.y+Math.sin(d)*(s.radius+1)}else{const d=i/n,l=r/n;o.x=s.x+d*(s.radius+1),o.y=s.y+l*(s.radius+1)}const h=o.vx*i+o.vy*r;h<0&&(o.vx-=h/(n*n)*i,o.vy-=h/(n*n)*r,o.targetVx=o.vx,o.targetVy=o.vy)}}function nt(o,t,e){const s=t.getObstaclesNear(o.x,o.y,o.perceptionRange);let i=1/0;for(const l of s){const a=l.distanceToEdge(o.x,o.y);a<i&&(i=a)}const r=t.getColony(o.colonyId);let n=0,h=0;if(r){const l=r.x-o.x,a=r.y-o.y;n=Math.sqrt(l*l+a*a),h=Math.atan2(a,l)}const d=new Map;return d.set(N.FOOD,F(o,t.pheromoneGrid,N.FOOD,e)),d.set(N.NEST,F(o,t.pheromoneGrid,N.NEST,e)),d.set(N.DANGER,F(o,t.pheromoneGrid,N.DANGER,e)),{nearbyObstacles:s,nearestObstacleDistance:i,distanceToHome:n,directionToHome:h,pheromoneGradients:d}}const b={idleToWanderingChance:D.IDLE_TO_WANDERING_CHANCE,wanderingMinDuration:D.WANDERING_MIN_DURATION,wanderingToForagingChance:D.WANDERING_TO_FORAGING_CHANCE,wanderingToReturningChance:D.WANDERING_TO_RETURNING_CHANCE,foragingMinDuration:D.FORAGING_MIN_DURATION,foragingToReturningChance:D.FORAGING_TO_RETURNING_CHANCE};function ht(o,t,e=b){const s=o.state,i=o.timeInCurrentState;switch(s){case E.IDLE:if(Math.random()<e.idleToWanderingChance*t)return E.WANDERING;break;case E.WANDERING:if(o.energy<O.THRESHOLDS.HUNGER){const r=O.HUNGER_RETURN_CHANCE*t;if(Math.random()<r)return E.RETURNING}if(i>=e.wanderingMinDuration){if(Math.random()<e.wanderingToForagingChance*t)return E.FORAGING;if(Math.random()<e.wanderingToReturningChance*t)return E.RETURNING}break;case E.FORAGING:if(o.energy<O.THRESHOLDS.HUNGER){const r=O.HUNGER_RETURN_CHANCE*2*t;if(Math.random()<r)return E.RETURNING}if(i>=e.foragingMinDuration&&Math.random()<e.foragingToReturningChance*t)return E.RETURNING;break;case E.RETURNING:break}return s}function x(o,t){o.state!==t&&(o.state=t,o.timeInCurrentState=0)}function ct(o,t,e){return t.getFoodSourcesNear(o.x,o.y,e)}function dt(o,t){const e=t.x-o.x,s=t.y-o.y;return Math.sqrt(e*e+s*s)<=t.radius+g.HARVEST_DISTANCE}function at(o,t,e){const s=C.MAX_CAPACITY-o.carriedFood;if(s<=0)return 0;const i=Math.min(s,e),r=t.harvest(i);return o.carriedFood+=r,r}function lt(o){return o.carriedFood>=C.MAX_CAPACITY}class Et{constructor(t){this.frameCounter=0,this.world=t,this.movementConfig={speed:m.SPEED,changeDirectionInterval:m.CHANGE_DIRECTION_INTERVAL,turnSpeed:m.TURN_SPEED},this.energyAdjustedMovementConfig={...this.movementConfig},this.transitionConfig=b,this.pheromoneBehaviorConfig={sampleDistance:S.SAMPLE_DISTANCE,followStrength:S.FOLLOW_STRENGTH,explorationRandomness:S.EXPLORATION_RANDOMNESS}}tick(t){const e=this.world.getColonies();for(const r of e)r.beginFrame();const s=this.world.getAllAnts(),i=[];for(const r of s)this.updateAntBehavior(r,t)&&i.push(r);for(const r of i)this.world.removeAnt(r);this.world.pheromoneGrid.decay(t,R.FOOD_DECAY_RATE,N.FOOD),this.world.pheromoneGrid.decay(t,R.NEST_DECAY_RATE,N.NEST),this.world.pheromoneGrid.decay(t,R.DANGER_DECAY_RATE,N.DANGER),this.frameCounter++,this.frameCounter>=R.DIFFUSION_UPDATE_INTERVAL&&(this.world.pheromoneGrid.diffuse(N.FOOD,R.DIFFUSION_RATE),this.world.pheromoneGrid.diffuse(N.NEST,R.DIFFUSION_RATE),this.world.pheromoneGrid.diffuse(N.DANGER,R.DIFFUSION_RATE),this.frameCounter=0),(!this.world.foodSource||this.world.foodSource.isDepleted())&&this.world.spawnFoodSource();for(const r of e)r.finalizeFrame(t)}updateAntBehavior(t,e){t.timeSinceDirectionChange+=e,t.timeInCurrentState+=e;const s=this.world.getColony(t.colonyId);if(!s)return!1;if(this.applyEnergyConsumption(t,e),t.energy<=0)return!0;const i=ht(t,e,this.transitionConfig);i!==t.state&&x(t,i);const r=this.getMovementConfigForAnt(t);switch(t.state){case E.IDLE:t.targetVx=0,t.targetVy=0,this.handleEating(t,s,e);break;case E.WANDERING:const d=nt(t,this.world,this.pheromoneBehaviorConfig.sampleDistance).pheromoneGradients.get(N.FOOD);if(d){const a=K(d,S.GRADIENT_THRESHOLD);a!==null?J(t,a,r.speed,this.pheromoneBehaviorConfig):t.timeSinceDirectionChange>=r.changeDirectionInterval&&(p(t,r),t.timeSinceDirectionChange=0)}else t.timeSinceDirectionChange>=r.changeDirectionInterval&&(p(t,r),t.timeSinceDirectionChange=0);break;case E.FORAGING:const l=ct(t,this.world,M.PERCEPTION_RANGE);if(l.length>0){const a=l[0];dt(t,a)?(at(t,a,g.HARVEST_RATE*e),(lt(t)||a.isDepleted())&&x(t,E.RETURNING)):H(t,a.x,a.y,r)}else t.timeSinceDirectionChange>=r.changeDirectionInterval&&(p(t,r),t.timeSinceDirectionChange=0);break;case E.RETURNING:Q(t,s.x,s.y,G.HOME_ARRIVAL_DISTANCE)?(t.carriedFood>0&&(s.addFood(t.carriedFood),t.carriedFood=0),x(t,E.IDLE),this.handleEating(t,s,e)):H(t,s.x,s.y,r);break}tt(t,r,e);const n=it(t,this.world,M.OBSTACLE_DETECTION_RANGE);return n&&ot(t,n,r),et(t,e),rt(t,this.world),st(t,this.world),this.depositPheromones(t),t.energy<=0}depositPheromones(t){switch(t.state){case E.IDLE:break;case E.WANDERING:this.world.pheromoneGrid.deposit(t.x,t.y,N.NEST,R.DEPOSITION_WANDERING);break;case E.FORAGING:const e=t.carriedFood>0?R.DEPOSITION_RETURNING:R.DEPOSITION_FORAGING;this.world.pheromoneGrid.deposit(t.x,t.y,N.FOOD,e),this.world.pheromoneGrid.deposit(t.x,t.y,N.NEST,R.DEPOSITION_WANDERING);break;case E.RETURNING:t.carriedFood>0&&this.world.pheromoneGrid.deposit(t.x,t.y,N.FOOD,R.DEPOSITION_RETURNING),this.world.pheromoneGrid.deposit(t.x,t.y,N.NEST,R.DEPOSITION_WANDERING);break}}applyEnergyConsumption(t,e){const i=this.getConsumptionRate(t.state)*e;t.energy=Math.max(0,t.energy-i),t.lastEnergyConsumption=i}getConsumptionRate(t){return O.CONSUMPTION_RATES[t]??0}getMovementConfigForAnt(t){const e=t.energy/O.MAX_ENERGY;let s=1;return e>=.8?s=O.SPEED_MULTIPLIERS.WELL_FED:e>=.5?s=O.SPEED_MULTIPLIERS.NORMAL:e>=.25?s=O.SPEED_MULTIPLIERS.HUNGRY:s=O.SPEED_MULTIPLIERS.STARVING,this.energyAdjustedMovementConfig.speed=this.movementConfig.speed*s,this.energyAdjustedMovementConfig.changeDirectionInterval=this.movementConfig.changeDirectionInterval,this.energyAdjustedMovementConfig.turnSpeed=this.movementConfig.turnSpeed,this.energyAdjustedMovementConfig}handleEating(t,e,s){if(t.energy>=O.MAX_ENERGY)return;const i=O.FOOD_CONSUMPTION_RATE*s,r=e.consumeFood(i);if(r>0){const n=r*O.ENERGY_PER_FOOD_UNIT;t.energy=Math.min(O.MAX_ENERGY,t.energy+n)}}update(t){this.tick(t)}initializeWorld(){const t=this.world.createColony(this.world.width/2,this.world.height/2);for(let e=0;e<z.INITIAL_ANT_COUNT;e++){const s=this.world.spawnAnt(t);p(s,this.movementConfig)}}}class Nt{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawAnt(e)}drawAnt(t){const e=Math.sqrt(t.vx*t.vx+t.vy*t.vy);let s=0,i=0;if(e>0){const n=t.vx/e,h=t.vy/e;s=n*(T.BODY_RADIUS+T.HEAD_RADIUS),i=h*(T.BODY_RADIUS+T.HEAD_RADIUS)}const r=T.STATE_COLORS[t.state]||T.DEFAULT_BODY_COLOR;if(this.graphics.fillStyle(r,1),this.graphics.fillCircle(t.x,t.y,T.BODY_RADIUS),this.graphics.fillStyle(T.HEAD_COLOR,1),this.graphics.fillCircle(t.x+s,t.y+i,T.HEAD_RADIUS),t.carriedFood>0){const n=t.carriedFood/C.MAX_CAPACITY,h=C.CARRYING_INDICATOR_RADIUS*n;this.graphics.fillStyle(C.CARRYING_INDICATOR_COLOR,.8),this.graphics.fillCircle(t.x,t.y,h)}}destroy(){this.graphics.destroy()}}class Rt{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawColony(e)}drawColony(t){this.graphics.fillStyle(f.NEST_COLOR,f.NEST_OPACITY),this.graphics.fillCircle(t.x,t.y,f.NEST_RADIUS),this.graphics.lineStyle(f.NEST_BORDER_WIDTH,f.NEST_BORDER_COLOR,1),this.graphics.strokeCircle(t.x,t.y,f.NEST_RADIUS),this.graphics.fillStyle(f.ENTRANCE_COLOR,f.ENTRANCE_OPACITY),this.graphics.fillCircle(t.x,t.y,f.NEST_RADIUS*f.ENTRANCE_RADIUS_MULTIPLIER)}destroy(){this.graphics.destroy()}}class Ot{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.graphics.fillStyle(4868682,1),this.graphics.fillCircle(e.x,e.y,e.radius),this.graphics.lineStyle(2,0,1),this.graphics.strokeCircle(e.x,e.y,e.radius)}destroy(){this.graphics.destroy()}}class It{constructor(t){this.scene=t,this.graphics=t.add.graphics(),this.graphics.setDepth(q.PHEROMONE_DEPTH),this.visible=!1,this.graphics.setVisible(!1)}render(t){if(!this.visible)return;this.graphics.clear();const e=t.getGridWidth(),s=t.getGridHeight(),i=t.getCellSize();this.renderPheromoneType(t,N.NEST,e,s,i,R.COLORS.NEST),this.renderPheromoneType(t,N.FOOD,e,s,i,R.COLORS.FOOD),this.renderPheromoneType(t,N.DANGER,e,s,i,R.COLORS.DANGER)}renderPheromoneType(t,e,s,i,r,n){const h=t.getGrid(e);if(!h)return;const d=n>>16&255,l=n>>8&255,a=n&255;for(let I=0;I<i;I++)for(let u=0;u<s;u++){const P=I*s+u,L=h[P];if(L>R.RENDER_THRESHOLD){const W=Math.min(L/R.MAX_STRENGTH,1),Y=Math.pow(W,R.VISUALIZATION_POWER)*R.MAX_OPACITY,B=u*r,V=I*r,X=A.Display.Color.GetColor(d,l,a);this.graphics.fillStyle(X,Y),this.graphics.fillRect(B,V,r,r)}}}toggle(){this.visible=!this.visible,this.graphics.setVisible(this.visible),this.visible||this.graphics.clear()}setVisible(t){this.visible=t,this.graphics.setVisible(t),t||this.graphics.clear()}isVisible(){return this.visible}destroy(){this.graphics.destroy()}}class ut{constructor(t){this.graphics=t.add.graphics({x:0,y:0})}render(t){if(this.graphics.clear(),!t)return;const e=Math.min(t.foodAmount/g.INITIAL_FOOD_AMOUNT,1),s=Math.max(.3,e);this.graphics.lineStyle(2,U.FOOD_BORDER_COLOR,s),this.graphics.strokeCircleShape(new A.Geom.Circle(t.x,t.y,t.radius+1)),this.graphics.fillStyle(U.FOOD_COLOR,s),this.graphics.fillCircleShape(new A.Geom.Circle(t.x,t.y,t.radius))}getGraphics(){return this.graphics}destroy(){this.graphics.destroy()}}class _{constructor(t,e,s){this.x=t,this.y=e,this.radius=s}containsPoint(t,e){const s=t-this.x,i=e-this.y;return s*s+i*i<=this.radius*this.radius}distanceToEdge(t,e){const s=t-this.x,i=e-this.y;return Math.sqrt(s*s+i*i)-this.radius}}class ft extends A.Scene{constructor(){super({key:"MainScene"})}create(){var s,i,r;this.cameras.main.setBackgroundColor(y.BACKGROUND_COLOR);const t=this.scale.width,e=this.scale.height;this.world=new j(t,e),this.simulationSystem=new Et(this.world),this.simulationSystem.initializeWorld(),this.addTestObstacles(),this.antRenderer=new Nt(this),this.colonyRenderer=new Rt(this),this.obstacleRenderer=new Ot(this),this.pheromoneRenderer=new It(this),this.foodSourceRenderer=new ut(this),this.add.text(c.TITLE.X,c.TITLE.Y,c.TITLE.TEXT,{fontSize:c.TITLE.FONT_SIZE,color:c.TITLE.COLOR,fontStyle:"bold"}).setDepth(c.UI_DEPTH),this.add.text(c.INSTRUCTIONS.X,c.INSTRUCTIONS.Y,c.INSTRUCTIONS.TEXT,{fontSize:c.INSTRUCTIONS.FONT_SIZE,color:c.INSTRUCTIONS.COLOR}).setDepth(c.UI_DEPTH),this.add.text(c.LEGEND.X,c.LEGEND.Y,c.LEGEND.TEXT,{fontSize:c.LEGEND.FONT_SIZE,color:c.LEGEND.COLOR}).setDepth(c.UI_DEPTH),this.pheromoneOverlayText=this.add.text(c.LEGEND.X,c.LEGEND.Y+20,"Press P to toggle pheromone overlay | Press T for test pattern",{fontSize:c.LEGEND.FONT_SIZE,color:c.LEGEND.COLOR}).setDepth(c.UI_DEPTH),this.debugText=this.add.text(c.DEBUG.X,this.scale.height-c.DEBUG.Y_OFFSET_FROM_BOTTOM,"",{fontSize:c.DEBUG.FONT_SIZE,color:c.DEBUG.COLOR,backgroundColor:c.DEBUG.BACKGROUND_COLOR,padding:c.DEBUG.PADDING}).setDepth(c.UI_DEPTH),this.metricsText=this.add.text(c.DEBUG.X,this.scale.height-c.DEBUG.Y_OFFSET_FROM_BOTTOM-30,"",{fontSize:c.DEBUG.FONT_SIZE,color:c.DEBUG.COLOR,backgroundColor:c.DEBUG.BACKGROUND_COLOR,padding:c.DEBUG.PADDING}).setDepth(c.UI_DEPTH),(s=this.input.keyboard)==null||s.on("keydown-P",()=>{this.pheromoneRenderer.toggle(),this.updatePheromoneOverlayText()}),(i=this.input.keyboard)==null||i.on("keydown-T",()=>{this.depositTestPheromones()}),(r=this.input.mouse)==null||r.disableContextMenu()}update(t,e){const s=e/1e3;this.simulationSystem.update(s),this.pheromoneRenderer.isVisible()&&this.pheromoneRenderer.render(this.world.pheromoneGrid),this.obstacleRenderer.render(this.world.getObstacles()),this.colonyRenderer.render(this.world.getColonies()),this.foodSourceRenderer.render(this.world.foodSource);const i=this.world.getAllAnts();this.antRenderer.render(i),this.updateDebugUI(i),this.updateMetricsUI(),this.handleTestPheromoneDeposition()}updatePheromoneOverlayText(){const t=this.pheromoneRenderer.isVisible()?"ON":"OFF";this.pheromoneOverlayText.setText(`Press P to toggle pheromone overlay (${t}) | Press T for test pattern`)}handleTestPheromoneDeposition(){const t=this.input.activePointer;t.leftButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,N.FOOD,.5),t.rightButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,N.NEST,.5),t.middleButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,N.DANGER,.5)}depositTestPheromones(){const t=this.scale.width/2,e=this.scale.height/2;for(let s=0;s<150;s++)this.world.pheromoneGrid.deposit(t-75+s,e-100,N.FOOD,3);for(let s=0;s<150;s++)this.world.pheromoneGrid.deposit(t-75+s,e,N.NEST,3);for(let s=0;s<60;s++)for(let i=0;i<60;i++)this.world.pheromoneGrid.deposit(t-30+s,e+50+i,N.DANGER,2);console.log("Test pheromones deposited! You should see red, blue, and yellow patterns.")}updateDebugUI(t){const e={[E.IDLE]:0,[E.WANDERING]:0,[E.FORAGING]:0,[E.RETURNING]:0};for(const i of t)e[i.state]++;const s=[`Total: ${t.length}`,`Idle: ${e[E.IDLE]}`,`Wandering: ${e[E.WANDERING]}`,`Foraging: ${e[E.FORAGING]}`,`Returning: ${e[E.RETURNING]}`].join(" | ");this.debugText.setText(s)}updateMetricsUI(){const t=this.world.getColonies()[0];if(!t)return;const e=t.getHealthStatus(),s=t.surplusRate,i=s>=0?`+${s.toFixed(2)}`:`${s.toFixed(2)}`,r=[`Food: ${t.foodStored.toFixed(1)}`,`Eaten: ${t.foodConsumedRate.toFixed(2)}/s`,`Gathered: ${t.foodGatheredRate.toFixed(2)}/s`,`Surplus: ${i}/s`,`Status: ${e}`].join(" | ");this.metricsText.setText(r)}addTestObstacles(){const t=this.scale.width/2,e=this.scale.height/2;this.world.addObstacle(new _(t/2,e/2,35)),this.world.addObstacle(new _(t*1.5,e/2,30)),this.world.addObstacle(new _(t/2,e*1.5,40)),this.world.addObstacle(new _(t*1.5,e*1.5,45)),this.world.addObstacle(new _(150,e,25))}shutdown(){this.antRenderer.destroy(),this.colonyRenderer.destroy(),this.obstacleRenderer.destroy(),this.pheromoneRenderer.destroy()}}const Tt={type:A.AUTO,width:y.CANVAS_WIDTH,height:y.CANVAS_HEIGHT,parent:"game-container",backgroundColor:y.BACKGROUND_COLOR,scene:[ft],scale:{mode:A.Scale.FIT,autoCenter:A.Scale.CENTER_BOTH}};new A.Game(Tt);
