import{P as g}from"./phaser-0RJB29YE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();var N=(s=>(s.IDLE="IDLE",s.WANDERING="WANDERING",s.FORAGING="FORAGING",s.RETURNING="RETURNING",s))(N||{});class X{constructor(t,e,i,o,r=100){this.carriedFood=0,this.id=t,this.x=e,this.y=i,this.vx=0,this.vy=0,this.targetVx=0,this.targetVy=0,this.state=N.IDLE,this.colonyId=o,this.timeSinceDirectionChange=0,this.timeInCurrentState=0,this.perceptionRange=r}}const S={CANVAS_WIDTH:1024,CANVAS_HEIGHT:768,BACKGROUND_COLOR:"#2d4a2e"},k={INITIAL_ANT_COUNT:40},y={SPEED:50,CHANGE_DIRECTION_INTERVAL:2,TURN_SPEED:.3},A={IDLE_TO_WANDERING_CHANCE:.5,WANDERING_MIN_DURATION:5,WANDERING_TO_FORAGING_CHANCE:.1,WANDERING_TO_RETURNING_CHANCE:.02,FORAGING_MIN_DURATION:5,FORAGING_TO_RETURNING_CHANCE:.1},U={HOME_ARRIVAL_DISTANCE:15,ENTRANCE_RADIUS:30},x={OBSTACLE_DETECTION_RANGE:80,PERCEPTION_RANGE:100},f={BODY_RADIUS:3,HEAD_RADIUS:2,HEAD_COLOR:6636321,STATE_COLORS:{IDLE:8421504,WANDERING:9127187,FORAGING:4881486,RETURNING:4286881},DEFAULT_BODY_COLOR:9127187},q={PHEROMONE_DEPTH:5},T={NEST_RADIUS:20,NEST_COLOR:7356948,NEST_BORDER_COLOR:9127187,NEST_BORDER_WIDTH:2,NEST_OPACITY:.6,ENTRANCE_RADIUS_MULTIPLIER:.4,ENTRANCE_COLOR:0,ENTRANCE_OPACITY:.3},a={TITLE:{X:16,Y:16,FONT_SIZE:"32px",COLOR:"#ffffff",TEXT:"Ants!"},INSTRUCTIONS:{X:16,Y:56,FONT_SIZE:"16px",COLOR:"#cccccc",TEXT:"Watch the ants wander and return home..."},LEGEND:{X:16,Y:84,FONT_SIZE:"12px",COLOR:"#aaaaaa",TEXT:"Colors: Gray=Idle, Brown=Wandering, Green=Foraging, Blue=Returning"},DEBUG:{X:16,Y_OFFSET_FROM_BOTTOM:40,FONT_SIZE:"14px",COLOR:"#ffffff",BACKGROUND_COLOR:"#00000088",PADDING:{x:8,y:4}},UI_DEPTH:100},O={GRID_CELL_SIZE:1,FOOD_DECAY_RATE:.05,NEST_DECAY_RATE:.03,DANGER_DECAY_RATE:.1,DEPOSITION_WANDERING:.5,DEPOSITION_FORAGING:.5,DEPOSITION_RETURNING:2,DIFFUSION_UPDATE_INTERVAL:3,DIFFUSION_RATE:.05,MAX_STRENGTH:20,MIN_STRENGTH:.001,RENDER_THRESHOLD:.01,VISUALIZATION_POWER:.5,MAX_OPACITY:.6,COLORS:{FOOD:16711680,NEST:255,DANGER:16776960}},C={SAMPLE_DISTANCE:80,FOLLOW_STRENGTH:.6,EXPLORATION_RANDOMNESS:.08,GRADIENT_THRESHOLD:.005},u={INITIAL_FOOD_AMOUNT:100,SOURCE_RADIUS:15,HARVEST_RATE:1,HARVEST_DISTANCE:20,SPAWN_EDGE_PADDING:30,SPAWN_ATTEMPTS:10,SPAWN_BUFFER_DISTANCE:15},_={MAX_CAPACITY:5,CARRYING_INDICATOR_RADIUS:1.5,CARRYING_INDICATOR_COLOR:16729156},P={FOOD_COLOR:13935988,FOOD_BORDER_COLOR:9137991};class z{constructor(t,e,i){this.id=t,this.x=e,this.y=i,this.ants=[],this.resourceCount=0}spawnAnt(t){const e=new X(t,this.x,this.y,this.id,x.PERCEPTION_RANGE);return this.ants.push(e),e}getAnts(){return[...this.ants]}getAntCount(){return this.ants.length}}class L{constructor(t,e,i,o,r){this.id=t,this.x=e,this.y=i,this.foodAmount=o,this.radius=r}harvest(t){const e=Math.min(t,this.foodAmount);return this.foodAmount-=e,e}isDepleted(){return this.foodAmount<=0}}var l=(s=>(s.FOOD="FOOD",s.NEST="NEST",s.DANGER="DANGER",s))(l||{});class Z{constructor(t,e,i){this.width=t,this.height=e,this.cellSize=i,this.gridWidth=Math.ceil(t/i),this.gridHeight=Math.ceil(e/i),this.grids=new Map;for(const o of Object.values(l))this.grids.set(o,new Float32Array(this.gridWidth*this.gridHeight));this.diffusionBuffer=new Float32Array(this.gridWidth*this.gridHeight)}deposit(t,e,i,o){const r=Math.floor(t/this.cellSize),n=Math.floor(e/this.cellSize);if(r<0||r>=this.gridWidth||n<0||n>=this.gridHeight)return;const h=this.grids.get(i);if(!h)return;const d=n*this.gridWidth+r;h[d]=Math.min(h[d]+o,O.MAX_STRENGTH)}sample(t,e,i){const o=Math.floor(t/this.cellSize),r=Math.floor(e/this.cellSize);if(o<0||o>=this.gridWidth||r<0||r>=this.gridHeight)return 0;const n=this.grids.get(i);if(!n)return 0;const h=r*this.gridWidth+o;return n[h]}decay(t,e,i){const o=this.grids.get(i);if(!o)return;const r=Math.pow(1-e,t);for(let n=0;n<o.length;n++)o[n]*=r,o[n]<O.MIN_STRENGTH&&(o[n]=0)}getGrid(t){return this.grids.get(t)}getGridWidth(){return this.gridWidth}getGridHeight(){return this.gridHeight}getCellSize(){return this.cellSize}diffuse(t,e){const i=this.grids.get(t);if(i){this.diffusionBuffer.fill(0);for(let o=0;o<this.gridHeight;o++)for(let r=0;r<this.gridWidth;r++){const n=o*this.gridWidth+r,h=i[n];let d=h,c=1;o>0&&(d+=i[(o-1)*this.gridWidth+r],c++),o<this.gridHeight-1&&(d+=i[(o+1)*this.gridWidth+r],c++),r>0&&(d+=i[o*this.gridWidth+(r-1)],c++),r<this.gridWidth-1&&(d+=i[o*this.gridWidth+(r+1)],c++);const E=d/c;this.diffusionBuffer[n]=h*(1-e)+E*e,this.diffusionBuffer[n]<O.MIN_STRENGTH&&(this.diffusionBuffer[n]=0)}i.set(this.diffusionBuffer)}}clear(){for(const t of this.grids.values())t.fill(0)}clearType(t){const e=this.grids.get(t);e&&e.fill(0)}}class ${constructor(t,e){this.foodSource=null,this.width=t,this.height=e,this.colonies=[],this.obstacles=[],this.pheromoneGrid=new Z(t,e,O.GRID_CELL_SIZE),this.nextAntId=0,this.nextFoodSourceId=0,this.cachedAnts=[],this.antsCacheDirty=!0}createColony(t,e){const i=this.colonies.length,o=new z(i,t,e);return this.colonies.push(o),o}spawnAnt(t){const e=t.spawnAnt(this.nextAntId++);return this.antsCacheDirty=!0,e}getAllAnts(){if(this.antsCacheDirty){this.cachedAnts=[];for(const t of this.colonies)this.cachedAnts.push(...t.getAnts());this.antsCacheDirty=!1}return this.cachedAnts}getColonies(){return[...this.colonies]}getColony(t){return this.colonies[t]}addObstacle(t){this.obstacles.push(t)}getObstacles(){return this.obstacles}getObstaclesNear(t,e,i){const o=[];for(const r of this.obstacles){const n=r.x-t,h=r.y-e;Math.sqrt(n*n+h*h)-r.radius<=i&&o.push(r)}return o}spawnFoodSource(){const t=u.SOURCE_RADIUS,e=u.SPAWN_EDGE_PADDING,i=u.SPAWN_ATTEMPTS;for(let h=0;h<i;h++){const d=e+Math.random()*(this.width-2*e),c=e+Math.random()*(this.height-2*e);if(this.isValidFoodSourceLocation(d,c,t)){const E=new L(`food_${this.nextFoodSourceId++}`,d,c,u.INITIAL_FOOD_AMOUNT,t);return this.foodSource=E,E}}const o=this.width-t-e,r=this.height-t-e,n=new L(`food_${this.nextFoodSourceId++}`,o,r,u.INITIAL_FOOD_AMOUNT,t);return this.foodSource=n,n}isValidFoodSourceLocation(t,e,i){const o=i+u.SPAWN_BUFFER_DISTANCE;for(const r of this.obstacles){const n=r.x-t,h=r.y-e;if(Math.sqrt(n*n+h*h)<o+r.radius)return!1}for(const r of this.colonies){const n=r.x-t,h=r.y-e;if(Math.sqrt(n*n+h*h)<o+U.ENTRANCE_RADIUS)return!1}return!0}getFoodSourcesNear(t,e,i){if(!this.foodSource)return[];const o=this.foodSource.x-t,r=this.foodSource.y-e;return Math.sqrt(o*o+r*r)<=i?[this.foodSource]:[]}}const b=[0,Math.PI/4,Math.PI/2,3*Math.PI/4,Math.PI,-3*Math.PI/4,-Math.PI/2,-Math.PI/4];function G(s,t,e,i){const o=[];let r=0;for(const h of b){const d=s.x+Math.cos(h)*i,c=s.y+Math.sin(h)*i,E=t.sample(d,c,e);o.push(E),E>r&&(r=E)}const n=Math.min(r,1);return{samples:o,maxConcentration:n}}function K(s,t=.01){if(s.maxConcentration<t)return null;let e=0,i=s.samples[0];for(let o=1;o<s.samples.length;o++)s.samples[o]>i&&(i=s.samples[o],e=o);return b[e]}function j(s,t,e,i){if(t===null||Math.random()<i.explorationRandomness){const E=Math.random()*Math.PI*2,R=Math.cos(E)*e,I=Math.sin(E)*e;s.targetVx=R,s.targetVy=I;return}const o=Math.cos(t)*e,r=Math.sin(t)*e,n=i.followStrength,h=(Math.random()-.5)*Math.PI*.2,d=Math.cos(h)*e*(1-n)*.3,c=Math.sin(h)*e*(1-n)*.3;s.targetVx=o*n+d,s.targetVy=r*n+c}function p(s,t){const e=Math.random()*Math.PI*2;s.targetVx=Math.cos(e)*t.speed,s.targetVy=Math.sin(e)*t.speed}function w(s,t,e,i){const o=t-s.x,r=e-s.y,n=Math.sqrt(o*o+r*r);n>0&&(s.targetVx=o/n*i.speed,s.targetVy=r/n*i.speed)}function J(s,t,e,i=10){const o=t-s.x,r=e-s.y;return o*o+r*r<i*i}function Q(s,t,e){const i=Math.min(1,t.turnSpeed*e*10);s.vx+=(s.targetVx-s.vx)*i,s.vy+=(s.targetVy-s.vy)*i}function tt(s,t){s.x+=s.vx*t,s.y+=s.vy*t}function et(s,t){(s.x<0||s.x>t.width)&&(s.vx*=-1,s.x=Math.max(0,Math.min(t.width,s.x))),(s.y<0||s.y>t.height)&&(s.vy*=-1,s.y=Math.max(0,Math.min(t.height,s.y)))}function st(s,t,e){const i=t.getObstaclesNear(s.x,s.y,e);if(i.length===0)return null;let o=null,r=1/0;const n=Math.sqrt(s.vx*s.vx+s.vy*s.vy);if(n===0)return null;const h=s.vx/n,d=s.vy/n;for(const c of i){const E=c.x-s.x,R=c.y-s.y,I=Math.sqrt(E*E+R*R);(E*h+R*d)/I>.5&&I<r&&(r=I,o=c)}return o}function it(s,t,e){const i=t.x-s.x,o=t.y-s.y,r=Math.sqrt(i*i+o*o);if(r===0)return;const n=-o,h=i,c=(s.vx*n+s.vy*h)/r>=0?1:-1;s.targetVx=c*(n/r)*e.speed,s.targetVy=c*(h/r)*e.speed}function ot(s,t){const e=t.getObstaclesNear(s.x,s.y,100);for(const i of e)if(i.containsPoint(s.x,s.y)){const o=s.x-i.x,r=s.y-i.y,n=Math.sqrt(o*o+r*r);if(n===0){const d=Math.random()*Math.PI*2;s.x=i.x+Math.cos(d)*(i.radius+1),s.y=i.y+Math.sin(d)*(i.radius+1)}else{const d=o/n,c=r/n;s.x=i.x+d*(i.radius+1),s.y=i.y+c*(i.radius+1)}const h=s.vx*o+s.vy*r;h<0&&(s.vx-=h/(n*n)*o,s.vy-=h/(n*n)*r,s.targetVx=s.vx,s.targetVy=s.vy)}}function rt(s,t,e){const i=t.getObstaclesNear(s.x,s.y,s.perceptionRange);let o=1/0;for(const c of i){const E=c.distanceToEdge(s.x,s.y);E<o&&(o=E)}const r=t.getColony(s.colonyId);let n=0,h=0;if(r){const c=r.x-s.x,E=r.y-s.y;n=Math.sqrt(c*c+E*E),h=Math.atan2(E,c)}const d=new Map;return d.set(l.FOOD,G(s,t.pheromoneGrid,l.FOOD,e)),d.set(l.NEST,G(s,t.pheromoneGrid,l.NEST,e)),d.set(l.DANGER,G(s,t.pheromoneGrid,l.DANGER,e)),{nearbyObstacles:i,nearestObstacleDistance:o,distanceToHome:n,directionToHome:h,pheromoneGradients:d}}const v={idleToWanderingChance:A.IDLE_TO_WANDERING_CHANCE,wanderingMinDuration:A.WANDERING_MIN_DURATION,wanderingToForagingChance:A.WANDERING_TO_FORAGING_CHANCE,wanderingToReturningChance:A.WANDERING_TO_RETURNING_CHANCE,foragingMinDuration:A.FORAGING_MIN_DURATION,foragingToReturningChance:A.FORAGING_TO_RETURNING_CHANCE};function nt(s,t,e=v){const i=s.state,o=s.timeInCurrentState;switch(i){case N.IDLE:if(Math.random()<e.idleToWanderingChance*t)return N.WANDERING;break;case N.WANDERING:if(o>=e.wanderingMinDuration){if(Math.random()<e.wanderingToForagingChance*t)return N.FORAGING;if(Math.random()<e.wanderingToReturningChance*t)return N.RETURNING}break;case N.FORAGING:if(o>=e.foragingMinDuration&&Math.random()<e.foragingToReturningChance*t)return N.RETURNING;break;case N.RETURNING:break}return i}function m(s,t){s.state!==t&&(s.state=t,s.timeInCurrentState=0)}function ht(s,t,e){return t.getFoodSourcesNear(s.x,s.y,e)}function ct(s,t){const e=t.x-s.x,i=t.y-s.y;return Math.sqrt(e*e+i*i)<=t.radius+u.HARVEST_DISTANCE}function dt(s,t,e){const i=_.MAX_CAPACITY-s.carriedFood;if(i<=0)return 0;const o=Math.min(i,e),r=t.harvest(o);return s.carriedFood+=r,r}function at(s){return s.carriedFood>=_.MAX_CAPACITY}class lt{constructor(t){this.frameCounter=0,this.world=t,this.movementConfig={speed:y.SPEED,changeDirectionInterval:y.CHANGE_DIRECTION_INTERVAL,turnSpeed:y.TURN_SPEED},this.transitionConfig=v,this.pheromoneBehaviorConfig={sampleDistance:C.SAMPLE_DISTANCE,followStrength:C.FOLLOW_STRENGTH,explorationRandomness:C.EXPLORATION_RANDOMNESS}}tick(t){const e=this.world.getAllAnts();for(const i of e)this.updateAntBehavior(i,t);this.world.pheromoneGrid.decay(t,O.FOOD_DECAY_RATE,l.FOOD),this.world.pheromoneGrid.decay(t,O.NEST_DECAY_RATE,l.NEST),this.world.pheromoneGrid.decay(t,O.DANGER_DECAY_RATE,l.DANGER),this.frameCounter++,this.frameCounter>=O.DIFFUSION_UPDATE_INTERVAL&&(this.world.pheromoneGrid.diffuse(l.FOOD,O.DIFFUSION_RATE),this.world.pheromoneGrid.diffuse(l.NEST,O.DIFFUSION_RATE),this.world.pheromoneGrid.diffuse(l.DANGER,O.DIFFUSION_RATE),this.frameCounter=0),(!this.world.foodSource||this.world.foodSource.isDepleted())&&this.world.spawnFoodSource()}updateAntBehavior(t,e){t.timeSinceDirectionChange+=e,t.timeInCurrentState+=e;const i=this.world.getColony(t.colonyId);if(!i)return;const o=nt(t,e,this.transitionConfig);switch(o!==t.state&&m(t,o),t.state){case N.IDLE:t.targetVx=0,t.targetVy=0;break;case N.WANDERING:const h=rt(t,this.world,this.pheromoneBehaviorConfig.sampleDistance).pheromoneGradients.get(l.FOOD);if(h){const c=K(h,C.GRADIENT_THRESHOLD);c!==null?j(t,c,this.movementConfig.speed,this.pheromoneBehaviorConfig):t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(p(t,this.movementConfig),t.timeSinceDirectionChange=0)}else t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(p(t,this.movementConfig),t.timeSinceDirectionChange=0);break;case N.FORAGING:const d=ht(t,this.world,x.PERCEPTION_RANGE);if(d.length>0){const c=d[0];ct(t,c)?(dt(t,c,u.HARVEST_RATE*e),(at(t)||c.isDepleted())&&m(t,N.RETURNING)):w(t,c.x,c.y,this.movementConfig)}else t.timeSinceDirectionChange>=this.movementConfig.changeDirectionInterval&&(p(t,this.movementConfig),t.timeSinceDirectionChange=0);break;case N.RETURNING:J(t,i.x,i.y,U.HOME_ARRIVAL_DISTANCE)?(t.carriedFood>0&&(i.resourceCount+=t.carriedFood,t.carriedFood=0),m(t,N.IDLE)):w(t,i.x,i.y,this.movementConfig);break}Q(t,this.movementConfig,e);const r=st(t,this.world,x.OBSTACLE_DETECTION_RANGE);r&&it(t,r,this.movementConfig),tt(t,e),ot(t,this.world),et(t,this.world),this.depositPheromones(t)}depositPheromones(t){switch(t.state){case N.IDLE:break;case N.WANDERING:this.world.pheromoneGrid.deposit(t.x,t.y,l.NEST,O.DEPOSITION_WANDERING);break;case N.FORAGING:const e=t.carriedFood>0?O.DEPOSITION_RETURNING:O.DEPOSITION_FORAGING;this.world.pheromoneGrid.deposit(t.x,t.y,l.FOOD,e),this.world.pheromoneGrid.deposit(t.x,t.y,l.NEST,O.DEPOSITION_WANDERING);break;case N.RETURNING:t.carriedFood>0&&this.world.pheromoneGrid.deposit(t.x,t.y,l.FOOD,O.DEPOSITION_RETURNING),this.world.pheromoneGrid.deposit(t.x,t.y,l.NEST,O.DEPOSITION_WANDERING);break}}update(t){this.tick(t)}initializeWorld(){const t=this.world.createColony(this.world.width/2,this.world.height/2);for(let e=0;e<k.INITIAL_ANT_COUNT;e++){const i=this.world.spawnAnt(t);p(i,this.movementConfig)}}}class Nt{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawAnt(e)}drawAnt(t){const e=Math.sqrt(t.vx*t.vx+t.vy*t.vy);let i=0,o=0;if(e>0){const n=t.vx/e,h=t.vy/e;i=n*(f.BODY_RADIUS+f.HEAD_RADIUS),o=h*(f.BODY_RADIUS+f.HEAD_RADIUS)}const r=f.STATE_COLORS[t.state]||f.DEFAULT_BODY_COLOR;if(this.graphics.fillStyle(r,1),this.graphics.fillCircle(t.x,t.y,f.BODY_RADIUS),this.graphics.fillStyle(f.HEAD_COLOR,1),this.graphics.fillCircle(t.x+i,t.y+o,f.HEAD_RADIUS),t.carriedFood>0){const n=t.carriedFood/_.MAX_CAPACITY,h=_.CARRYING_INDICATOR_RADIUS*n;this.graphics.fillStyle(_.CARRYING_INDICATOR_COLOR,.8),this.graphics.fillCircle(t.x,t.y,h)}}destroy(){this.graphics.destroy()}}class Et{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.drawColony(e)}drawColony(t){this.graphics.fillStyle(T.NEST_COLOR,T.NEST_OPACITY),this.graphics.fillCircle(t.x,t.y,T.NEST_RADIUS),this.graphics.lineStyle(T.NEST_BORDER_WIDTH,T.NEST_BORDER_COLOR,1),this.graphics.strokeCircle(t.x,t.y,T.NEST_RADIUS),this.graphics.fillStyle(T.ENTRANCE_COLOR,T.ENTRANCE_OPACITY),this.graphics.fillCircle(t.x,t.y,T.NEST_RADIUS*T.ENTRANCE_RADIUS_MULTIPLIER)}destroy(){this.graphics.destroy()}}class Ot{constructor(t){this.graphics=t.add.graphics()}render(t){this.graphics.clear();for(const e of t)this.graphics.fillStyle(4868682,1),this.graphics.fillCircle(e.x,e.y,e.radius),this.graphics.lineStyle(2,0,1),this.graphics.strokeCircle(e.x,e.y,e.radius)}destroy(){this.graphics.destroy()}}class Rt{constructor(t){this.scene=t,this.graphics=t.add.graphics(),this.graphics.setDepth(q.PHEROMONE_DEPTH),this.visible=!1,this.graphics.setVisible(!1)}render(t){if(!this.visible)return;this.graphics.clear();const e=t.getGridWidth(),i=t.getGridHeight(),o=t.getCellSize();this.renderPheromoneType(t,l.NEST,e,i,o,O.COLORS.NEST),this.renderPheromoneType(t,l.FOOD,e,i,o,O.COLORS.FOOD),this.renderPheromoneType(t,l.DANGER,e,i,o,O.COLORS.DANGER)}renderPheromoneType(t,e,i,o,r,n){const h=t.getGrid(e);if(!h)return;const d=n>>16&255,c=n>>8&255,E=n&255;for(let R=0;R<o;R++)for(let I=0;I<i;I++){const F=R*i+I,M=h[F];if(M>O.RENDER_THRESHOLD){const H=Math.min(M/O.MAX_STRENGTH,1),W=Math.pow(H,O.VISUALIZATION_POWER)*O.MAX_OPACITY,V=I*r,B=R*r,Y=g.Display.Color.GetColor(d,c,E);this.graphics.fillStyle(Y,W),this.graphics.fillRect(V,B,r,r)}}}toggle(){this.visible=!this.visible,this.graphics.setVisible(this.visible),this.visible||this.graphics.clear()}setVisible(t){this.visible=t,this.graphics.setVisible(t),t||this.graphics.clear()}isVisible(){return this.visible}destroy(){this.graphics.destroy()}}class It{constructor(t){this.graphics=t.add.graphics({x:0,y:0})}render(t){if(this.graphics.clear(),!t)return;const e=Math.min(t.foodAmount/u.INITIAL_FOOD_AMOUNT,1),i=Math.max(.3,e);this.graphics.lineStyle(2,P.FOOD_BORDER_COLOR,i),this.graphics.strokeCircleShape(new g.Geom.Circle(t.x,t.y,t.radius+1)),this.graphics.fillStyle(P.FOOD_COLOR,i),this.graphics.fillCircleShape(new g.Geom.Circle(t.x,t.y,t.radius))}getGraphics(){return this.graphics}destroy(){this.graphics.destroy()}}class D{constructor(t,e,i){this.x=t,this.y=e,this.radius=i}containsPoint(t,e){const i=t-this.x,o=e-this.y;return i*i+o*o<=this.radius*this.radius}distanceToEdge(t,e){const i=t-this.x,o=e-this.y;return Math.sqrt(i*i+o*o)-this.radius}}class Tt extends g.Scene{constructor(){super({key:"MainScene"})}create(){var i,o,r;this.cameras.main.setBackgroundColor(S.BACKGROUND_COLOR);const t=this.scale.width,e=this.scale.height;this.world=new $(t,e),this.simulationSystem=new lt(this.world),this.simulationSystem.initializeWorld(),this.addTestObstacles(),this.antRenderer=new Nt(this),this.colonyRenderer=new Et(this),this.obstacleRenderer=new Ot(this),this.pheromoneRenderer=new Rt(this),this.foodSourceRenderer=new It(this),this.add.text(a.TITLE.X,a.TITLE.Y,a.TITLE.TEXT,{fontSize:a.TITLE.FONT_SIZE,color:a.TITLE.COLOR,fontStyle:"bold"}).setDepth(a.UI_DEPTH),this.add.text(a.INSTRUCTIONS.X,a.INSTRUCTIONS.Y,a.INSTRUCTIONS.TEXT,{fontSize:a.INSTRUCTIONS.FONT_SIZE,color:a.INSTRUCTIONS.COLOR}).setDepth(a.UI_DEPTH),this.add.text(a.LEGEND.X,a.LEGEND.Y,a.LEGEND.TEXT,{fontSize:a.LEGEND.FONT_SIZE,color:a.LEGEND.COLOR}).setDepth(a.UI_DEPTH),this.pheromoneOverlayText=this.add.text(a.LEGEND.X,a.LEGEND.Y+20,"Press P to toggle pheromone overlay | Press T for test pattern",{fontSize:a.LEGEND.FONT_SIZE,color:a.LEGEND.COLOR}).setDepth(a.UI_DEPTH),this.debugText=this.add.text(a.DEBUG.X,this.scale.height-a.DEBUG.Y_OFFSET_FROM_BOTTOM,"",{fontSize:a.DEBUG.FONT_SIZE,color:a.DEBUG.COLOR,backgroundColor:a.DEBUG.BACKGROUND_COLOR,padding:a.DEBUG.PADDING}).setDepth(a.UI_DEPTH),(i=this.input.keyboard)==null||i.on("keydown-P",()=>{this.pheromoneRenderer.toggle(),this.updatePheromoneOverlayText()}),(o=this.input.keyboard)==null||o.on("keydown-T",()=>{this.depositTestPheromones()}),(r=this.input.mouse)==null||r.disableContextMenu()}update(t,e){const i=e/1e3;this.simulationSystem.update(i),this.pheromoneRenderer.isVisible()&&this.pheromoneRenderer.render(this.world.pheromoneGrid),this.obstacleRenderer.render(this.world.getObstacles()),this.colonyRenderer.render(this.world.getColonies()),this.foodSourceRenderer.render(this.world.foodSource);const o=this.world.getAllAnts();this.antRenderer.render(o),this.updateDebugUI(o),this.handleTestPheromoneDeposition()}updatePheromoneOverlayText(){const t=this.pheromoneRenderer.isVisible()?"ON":"OFF";this.pheromoneOverlayText.setText(`Press P to toggle pheromone overlay (${t}) | Press T for test pattern`)}handleTestPheromoneDeposition(){const t=this.input.activePointer;t.leftButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,l.FOOD,.5),t.rightButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,l.NEST,.5),t.middleButtonDown()&&this.world.pheromoneGrid.deposit(t.x,t.y,l.DANGER,.5)}depositTestPheromones(){const t=this.scale.width/2,e=this.scale.height/2;for(let i=0;i<150;i++)this.world.pheromoneGrid.deposit(t-75+i,e-100,l.FOOD,3);for(let i=0;i<150;i++)this.world.pheromoneGrid.deposit(t-75+i,e,l.NEST,3);for(let i=0;i<60;i++)for(let o=0;o<60;o++)this.world.pheromoneGrid.deposit(t-30+i,e+50+o,l.DANGER,2);console.log("Test pheromones deposited! You should see red, blue, and yellow patterns.")}updateDebugUI(t){const e={[N.IDLE]:0,[N.WANDERING]:0,[N.FORAGING]:0,[N.RETURNING]:0};for(const o of t)e[o.state]++;const i=[`Total: ${t.length}`,`Idle: ${e[N.IDLE]}`,`Wandering: ${e[N.WANDERING]}`,`Foraging: ${e[N.FORAGING]}`,`Returning: ${e[N.RETURNING]}`].join(" | ");this.debugText.setText(i)}addTestObstacles(){const t=this.scale.width/2,e=this.scale.height/2;this.world.addObstacle(new D(t/2,e/2,35)),this.world.addObstacle(new D(t*1.5,e/2,30)),this.world.addObstacle(new D(t/2,e*1.5,40)),this.world.addObstacle(new D(t*1.5,e*1.5,45)),this.world.addObstacle(new D(150,e,25))}shutdown(){this.antRenderer.destroy(),this.colonyRenderer.destroy(),this.obstacleRenderer.destroy(),this.pheromoneRenderer.destroy()}}const ft={type:g.AUTO,width:S.CANVAS_WIDTH,height:S.CANVAS_HEIGHT,parent:"game-container",backgroundColor:S.BACKGROUND_COLOR,scene:[Tt],scale:{mode:g.Scale.FIT,autoCenter:g.Scale.CENTER_BOTH}};new g.Game(ft);
